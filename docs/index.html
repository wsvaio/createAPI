<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@wsvaio/api</title><meta name="description" content="Documentation for @wsvaio/api"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@wsvaio/api</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>@wsvaio/api</h2></div><div class="tsd-panel tsd-typography"><center>

<a id="md:wsvaioapi" class="tsd-anchor"></a><h1><a href="#md:wsvaioapi">@wsvaio/api</a></h1><p>一个使用 TypeScript 编写，<strong>通用</strong>的网络请求库，主要用于处理 HTTP 请求</p>
<p><a href="https://www.npmjs.com/package/@wsvaio/api"><img src="https://img.shields.io/bundlephobia/minzip/@wsvaio/api/latest" alt="Size"></a> <a href="https://www.npmjs.com/package/@wsvaio/api"><img src="https://img.shields.io/npm/v/@wsvaio/api" alt="Version"></a> <a href="https://www.npmjs.com/package/@wsvaio/api"><img src="https://img.shields.io/github/languages/top/wsvaio/api" alt="Languages"></a> <a href="https://www.npmjs.com/package/@wsvaio/api"><img src="https://img.shields.io/npm/l/@wsvaio/api" alt="License"></a> <a href="https://github.com/wsvaio/api"><img src="https://img.shields.io/github/stars/wsvaio/api" alt="Star"></a> <a href="https://www.npmjs.com/package/@wsvaio/api"><img src="https://img.shields.io/npm/dm/@wsvaio/api" alt="Download"></a></p>
</center>

<a id="md:特性" class="tsd-anchor"></a><h2><a href="#md:特性">特性</a></h2><ul>
<li>✨ 通用的现代网络请求库，可以兼容多种环境</li>
<li>🎉 使用 TypeScript 编写，完善的类型支持</li>
<li>🎨 支持请求中间件，方便扩展功能</li>
<li>🎇 提供创建 API、设置全局上下文、执行请求等功能</li>
<li>🎏 支持合并上下文和配置，方便定制请求行为</li>
<li>🤖 内置实用中间件，如 URL 拼接、返回结果检查等</li>
<li>👾 支持日志输出，方便调试和查看请求情况</li>
<li>🐲 提供柯里化配置，优雅的封装接口</li>
<li>🐳 易于使用，帮助快速处理各种网络请求</li>
</ul>
<a id="md:api" class="tsd-anchor"></a><h2><a href="#md:api">API</a></h2><p><a href="https://wsvaio.github.io/api/modules.html">document……</a></p>
<a id="md:快速使用" class="tsd-anchor"></a><h2><a href="#md:快速使用">快速使用</a></h2><a id="md:安装" class="tsd-anchor"></a><h3><a href="#md:安装">安装</a></h3><pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">install</span><span class="hl-1"> @</span><span class="hl-0">wsvaio</span><span class="hl-1">/</span><span class="hl-0">api</span>
</code><button>Copy</button></pre>
<a id="md:使用方法" class="tsd-anchor"></a><h3><a href="#md:使用方法">使用方法</a></h3><p>首先，需要引入请求库：</p>
<pre><code><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-0">createNativeFetch</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@wsvaio/api&quot;</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<p>接下来，可以创建一个 API 实例：</p>
<pre><code class="language-javascript"><span class="hl-4">// 创建api实例并带有两个自定义属性</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">post</span><span class="hl-1">, </span><span class="hl-6">get</span><span class="hl-1">, </span><span class="hl-6">put</span><span class="hl-1">, </span><span class="hl-6">patch</span><span class="hl-1">, </span><span class="hl-6">del</span><span class="hl-1">, </span><span class="hl-6">request</span><span class="hl-1">, </span><span class="hl-6">use</span><span class="hl-1"> } = </span><span class="hl-7">createByNativeFetch</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">    </span><span class="hl-0">success</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">// 请求成功时的消息</span><br/><span class="hl-1">    </span><span class="hl-0">noticeable</span><span class="hl-1">?: </span><span class="hl-8">boolean</span><span class="hl-1">; </span><span class="hl-4">// 是否需要通知</span><br/><span class="hl-1">}&gt;({</span><br/><span class="hl-1">    </span><span class="hl-0">base:</span><span class="hl-1"> </span><span class="hl-3">&quot;https://api.example.com&quot;</span><span class="hl-1">,</span><br/><br/><span class="hl-1">    </span><span class="hl-0">log:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">noticeable:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">// headers...</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-4">// 其他配置选项...</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>配置请求中间件：</p>
<pre><code class="language-javascript"><span class="hl-4">// before 请求发出前</span><br/><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;before&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">Progress</span><span class="hl-1">.</span><span class="hl-7">start</span><span class="hl-1">());</span><br/><br/><span class="hl-4">// 设置请求token</span><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;before&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">auth</span><span class="hl-1"> = </span><span class="hl-7">useAuthStore</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">headers</span><span class="hl-1">.</span><span class="hl-0">Authorization</span><span class="hl-1"> = </span><span class="hl-3">`Bearer </span><span class="hl-5">${</span><span class="hl-0">auth</span><span class="hl-9">.</span><span class="hl-0">accessToken</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// after 请求发出后</span><br/><br/><span class="hl-4">// 抛出错误</span><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;after&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">if</span><span class="hl-1"> (</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">?.</span><span class="hl-0">code</span><span class="hl-1"> != </span><span class="hl-10">200</span><span class="hl-1">) </span><span class="hl-2">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-7">Error</span><span class="hl-1">(</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">message</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-4">// data扁平化</span><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;after&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> (</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1"> = </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">));</span><br/><br/><span class="hl-4">// error 错误处理</span><br/><br/><span class="hl-4">// 单独处理401</span><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;error&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">if</span><span class="hl-1"> (</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">?.</span><span class="hl-0">code</span><span class="hl-1"> != </span><span class="hl-10">401</span><span class="hl-1">) </span><span class="hl-2">return</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">// handle...</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// final 收尾</span><br/><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;final&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">Progress</span><span class="hl-1">.</span><span class="hl-7">done</span><span class="hl-1">(!</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">));</span><br/><span class="hl-4">// 通过扩展自定义属性实现通知</span><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;final&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><br/><span class="hl-1">  </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">noticeable</span><br/><span class="hl-1">    ? </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">message</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">ElNotification</span><span class="hl-1">.</span><span class="hl-7">error</span><span class="hl-1">(</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">message</span><span class="hl-1">)</span><br/><span class="hl-1">    : </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">success</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">ElNotification</span><span class="hl-1">.</span><span class="hl-7">success</span><span class="hl-1">(</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">success</span><span class="hl-1">)</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>您可以预先定义请求接口：</p>
<pre><code class="language-javascript"><span class="hl-4">// 简单定义</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">getUser</span><span class="hl-1"> = </span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-3">&quot;/user/:id&quot;</span><span class="hl-1">);</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">addUser</span><span class="hl-1"> = </span><span class="hl-7">post</span><span class="hl-1">(</span><span class="hl-3">&quot;/user&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">// 或者传入一个对象</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">editUser</span><span class="hl-1"> = </span><span class="hl-7">put</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">url:</span><span class="hl-1"> </span><span class="hl-3">&quot;/user/:id&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">param:</span><span class="hl-1"> { </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> }, </span><span class="hl-4">// param参数</span><br/><span class="hl-1">  </span><span class="hl-0">body:</span><span class="hl-1"> { </span><span class="hl-0">username:</span><span class="hl-1"> </span><span class="hl-3">&quot;oiavsw&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">config:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">, </span><span class="hl-4">// 必须设置config=true，否则将会执行请求</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>现在，可以使用 api 实例发起请求：</p>
<pre><code class="language-javascript"><span class="hl-4">// 直接发送请求</span><br/><span class="hl-7">get</span><span class="hl-1">({ </span><span class="hl-0">url:</span><span class="hl-1"> </span><span class="hl-3">&quot;/users&quot;</span><span class="hl-1"> }).</span><span class="hl-7">then</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// POST 请求</span><br/><span class="hl-7">post</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">url:</span><span class="hl-1"> </span><span class="hl-3">&quot;/users&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">body:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">name:</span><span class="hl-1"> </span><span class="hl-3">&quot;张三&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-0">age:</span><span class="hl-1"> </span><span class="hl-10">30</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">}).</span><span class="hl-7">then</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// 发送预先定义的请求</span><br/><span class="hl-7">getUser</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">// 请求后显示通知</span><br/><span class="hl-1">    </span><span class="hl-0">noticeable:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">// 请求成功时的通知</span><br/><span class="hl-1">    </span><span class="hl-0">success:</span><span class="hl-1"> </span><span class="hl-3">&quot;获取成功&quot;</span><br/><span class="hl-1">    </span><span class="hl-4">// param参数</span><br/><span class="hl-1">    </span><span class="hl-0">param</span><span class="hl-1">: { </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> },</span><br/><span class="hl-1">}).</span><span class="hl-7">then</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">// 响应</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">addUser</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">// body 参数</span><br/><span class="hl-1">    </span><span class="hl-0">body:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">username:</span><span class="hl-1"> </span><span class="hl-3">&#39;wsvaio&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}).</span><span class="hl-7">then</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">// 响应</span><br/><span class="hl-1">    </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">editUser</span><span class="hl-1">();</span>
</code><button>Copy</button></pre>
<a id="md:通用性" class="tsd-anchor"></a><h2><a href="#md:通用性">通用性</a></h2><p>通过提供不同的requester，可兼容不同的平台</p>
<p>内置：</p>
<ul>
<li>nativeFetchRequester //原生fetch</li>
<li>uniappRequester // uniapp环境下的request</li>
<li>nuxtFetchRequester // nuxt环境下的$fetch</li>
</ul>
<p>例如要兼容uniapp，则可以使用uniappRequester</p>
<pre><code class="language-ts"><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-0">create</span><span class="hl-1">, </span><span class="hl-0">uniappRequester</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@wsvaio/api&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">get</span><span class="hl-1"> } = </span><span class="hl-7">create</span><span class="hl-1">(</span><span class="hl-0">uniappRequester</span><span class="hl-1">)({</span><br/><span class="hl-1">  </span><span class="hl-0">base:</span><span class="hl-1"> </span><span class="hl-3">&quot;http://localhost&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">log:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">get</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">q:</span><span class="hl-1"> { </span><span class="hl-0">q1:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> },</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>createByNtiveFetch({...}) 相当于 create(nativeFetchRequester)({...})</p>
<a id="md:自定义requester" class="tsd-anchor"></a><h2><a href="#md:自定义requester">自定义requester</a></h2><p>通过 defineRequester 可以自定义请求器，例如一个简易的fetch请求器：</p>
<pre><code class="language-ts"><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-0">defineRequester</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@wsvaio/api&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">myNativeFetchRequester</span><span class="hl-1"> = </span><span class="hl-7">defineRequester</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-7">async</span><span class="hl-1"> (</span><br/><span class="hl-1">    </span><span class="hl-0">ctx</span><span class="hl-1">: </span><span class="hl-7">CoreContext</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">      </span><span class="hl-4">// ……自定义类型</span><br/><span class="hl-1">    }&gt;</span><br/><span class="hl-1">  ) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">response</span><span class="hl-1"> = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-7">fetch</span><span class="hl-1">(</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">url</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-2">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">// 必须返回这三个属性</span><br/><span class="hl-1">      </span><span class="hl-0">data:</span><span class="hl-1"> </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">response</span><span class="hl-1">.</span><span class="hl-7">json</span><span class="hl-1">(),</span><br/><span class="hl-1">      </span><span class="hl-0">message:</span><span class="hl-1"> </span><span class="hl-0">response</span><span class="hl-1">.</span><span class="hl-0">statusText</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-0">status:</span><span class="hl-1"> </span><span class="hl-0">response</span><span class="hl-1">.</span><span class="hl-0">status</span><span class="hl-1">,</span><br/><br/><span class="hl-1">      </span><span class="hl-4">// 可以额外返回一些自定义属性</span><br/><span class="hl-1">      </span><span class="hl-0">test:</span><span class="hl-1"> </span><span class="hl-3">&quot;my requester&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p><strong>通用性的核心就是通过定义不同环境下的requester来实现的</strong></p>
<a id="md:中间件" class="tsd-anchor"></a><h2><a href="#md:中间件">中间件</a></h2><p>本请求库支持使用中间件来扩展功能。以下是一些示例：</p>
<a id="md:请求前中间件" class="tsd-anchor"></a><h3><a href="#md:请求前中间件">请求前中间件</a></h3><pre><code class="language-javascript"><span class="hl-0">api</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;before&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-3">&quot;请求前&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:请求后中间件" class="tsd-anchor"></a><h3><a href="#md:请求后中间件">请求后中间件</a></h3><pre><code class="language-javascript"><span class="hl-0">api</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;after&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-3">&quot;请求后&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:错误处理中间件" class="tsd-anchor"></a><h3><a href="#md:错误处理中间件">错误处理中间件</a></h3><pre><code class="language-javascript"><span class="hl-0">api</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;error&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-3">&quot;错误处理&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:最终处理中间件" class="tsd-anchor"></a><h3><a href="#md:最终处理中间件">最终处理中间件</a></h3><pre><code class="language-javascript"><span class="hl-0">api</span><span class="hl-1">.</span><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;final&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-3">&quot;最终处理&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:柯里化配置" class="tsd-anchor"></a><h2><a href="#md:柯里化配置">柯里化配置</a></h2><p>get、post 等http方法是柯里化的，可以无限递归，专门用于封装接口。必须设置 { config: true } 才会递归下去，否则将会执行请求</p>
<pre><code class="language-typescript"><span class="hl-4">// 创建配置</span><br/><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-0">createByNativeFetch</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@wsvaio/api&quot;</span><span class="hl-1">;</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">get</span><span class="hl-1">, </span><span class="hl-6">request</span><span class="hl-1"> } = </span><span class="hl-7">createByNativeFetch</span><span class="hl-1">();</span><br/><span class="hl-4">// 柯里化配置</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">getTest1</span><span class="hl-1"> = </span><span class="hl-7">get</span><span class="hl-1">({ </span><span class="hl-0">url:</span><span class="hl-1"> </span><span class="hl-3">&quot;/test&quot;</span><span class="hl-1">, </span><span class="hl-0">config:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> });</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">getTest2</span><span class="hl-1"> = </span><span class="hl-7">get</span><span class="hl-1">({ </span><span class="hl-0">query:</span><span class="hl-1"> { </span><span class="hl-0">q1:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> }, </span><span class="hl-0">config:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> })({ </span><span class="hl-0">param:</span><span class="hl-1"> { </span><span class="hl-0">p1:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> }, </span><span class="hl-0">config:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1"> })({</span><br/><span class="hl-1">  </span><span class="hl-0">body:</span><span class="hl-1"> { </span><span class="hl-0">b1:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">config:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">getTest3</span><span class="hl-1"> = </span><span class="hl-7">get</span><span class="hl-1">(</span><span class="hl-3">&quot;/test&quot;</span><span class="hl-1">); </span><span class="hl-4">// 相当于 { path: &#39;/test&#39;, config: true }</span><br/><span class="hl-4">// 发送请求</span><br/><span class="hl-7">getTest1</span><span class="hl-1">({ </span><span class="hl-0">query:</span><span class="hl-1"> { </span><span class="hl-0">p1:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> } }).</span><span class="hl-7">then</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">));</span><br/><span class="hl-7">getTest2</span><span class="hl-1">({ </span><span class="hl-0">query:</span><span class="hl-1"> { </span><span class="hl-0">p2:</span><span class="hl-1"> </span><span class="hl-10">2</span><span class="hl-1"> } }).</span><span class="hl-7">then</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">));</span><br/><span class="hl-7">getTest3</span><span class="hl-1">().</span><span class="hl-7">then</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-0">data</span><span class="hl-1">));</span><br/><br/><span class="hl-4">// 获取context</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">context</span><span class="hl-1"> = </span><span class="hl-7">getTest3</span><span class="hl-1">();</span><br/><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-7">log</span><span class="hl-1">(</span><span class="hl-0">context</span><span class="hl-1">)</span><br/><span class="hl-4">// 获取data</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">data</span><span class="hl-1"> = </span><span class="hl-2">await</span><span class="hl-1"> </span><span class="hl-0">context</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<a id="md:typescirpt" class="tsd-anchor"></a><h2><a href="#md:typescirpt">Typescirpt</a></h2><p>类型支持！不同的requester也会有不同的类型</p>
<p>柯里化的泛型支持</p>
<pre><code class="language-typescript"><span class="hl-4">// 泛型支持，可无限递归配置，对当前无影响，对递归的下一级有影响，后续则都为可选</span><br/><span class="hl-4">// data 为特殊保留字段，不会作用，但会影响返回值的类型</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">getUser</span><span class="hl-1"> = </span><span class="hl-7">get</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">  </span><span class="hl-0">body</span><span class="hl-1">: {}; </span><span class="hl-4">// 配置body类型</span><br/><span class="hl-1">  </span><span class="hl-0">query</span><span class="hl-1">: {}; </span><span class="hl-4">// 配置query类型</span><br/><span class="hl-1">  </span><span class="hl-0">param</span><span class="hl-1">: {}; </span><span class="hl-4">// 配置param类型</span><br/><span class="hl-1">  </span><span class="hl-0">data</span><span class="hl-1">: {}; </span><span class="hl-4">// 配置data返回结果</span><br/><span class="hl-1">}&gt;(</span><span class="hl-3">&quot;/user&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">// 支持递归</span><br/><span class="hl-7">getUser</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">  </span><span class="hl-0">body</span><span class="hl-1">: {};</span><br/><span class="hl-1">}&gt;({});</span>
</code><button>Copy</button></pre>
<a id="md:扩展、继承-api-实例" class="tsd-anchor"></a><h2><a href="#md:扩展、继承-api-实例">扩展、继承 API 实例</a></h2><p>将要继承的ctx作为参数传入，即可扩展一个新的 API 实例：</p>
<pre><code class="language-typescript"><span class="hl-4">// 创建配置</span><br/><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-0">createNativeFetchAPI</span><span class="hl-1">, </span><span class="hl-0">mergeContext</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@wsvaio/api&quot;</span><span class="hl-1">;</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">ctx</span><span class="hl-1"> } = </span><span class="hl-7">createNativeFetchAPI</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">baseURL:</span><span class="hl-1"> </span><span class="hl-3">&quot;/api&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// 继承父级的配置</span><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">get</span><span class="hl-1"> } = </span><span class="hl-7">createNativeFetchAPI</span><span class="hl-1">({</span><br/><span class="hl-1">  ...</span><span class="hl-0">ctx</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">// 甚至多个父级</span><br/><span class="hl-1">  ...</span><span class="hl-7">mergeContext</span><span class="hl-1">(</span><span class="hl-0">ctx1</span><span class="hl-1">, </span><span class="hl-0">ctx2</span><span class="hl-1">, </span><span class="hl-0">ctx3</span><span class="hl-1">...),</span><br/><span class="hl-1">  </span><span class="hl-0">other:</span><span class="hl-1"> {},</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// 发送请求</span><br/><span class="hl-7">get</span><span class="hl-1">({ </span><span class="hl-0">url:</span><span class="hl-1"> </span><span class="hl-3">&quot;/test&quot;</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
<a id="md:日志打印" class="tsd-anchor"></a><h2><a href="#md:日志打印">日志打印</a></h2><pre><code class="language-typescript"><span class="hl-4">// 创建配置</span><br/><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-0">createByNativeFetch</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@wsvaio/api&quot;</span><span class="hl-1">;</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">get</span><span class="hl-1"> } = </span><span class="hl-7">createByNativeFetch</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">log:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">, </span><span class="hl-4">// 日志打印</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:额外扩展示例" class="tsd-anchor"></a><h2><a href="#md:额外扩展示例">额外扩展示例</a></h2><p>通过自定义类型+中间件+柯里化配置等，可以灵活的控制请求过程，甚至添加一些额外的实用功能</p>
<p>只有想不到，没有做不到</p>
<p><strong>整体思路</strong></p>
<p>通过自定义类型，要求调用者可以传入一些自定义属性</p>
<p>在中间件下对实现相关功能，与自定义属性实现联动</p>
<h3 id="为querybodyparam添加别名支">为query、body、param添加别名支持q、b、p</h3>

<p>只需要在before中间件将q、b、p与query、body、param赋值便可</p>
<pre><code class="language-ts"><span class="hl-2">import</span><span class="hl-1"> { </span><span class="hl-0">createByNativeFetch</span><span class="hl-1"> } </span><span class="hl-2">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@wsvaio/api&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">post</span><span class="hl-1">, </span><span class="hl-6">get</span><span class="hl-1">, </span><span class="hl-6">put</span><span class="hl-1">, </span><span class="hl-6">patch</span><span class="hl-1">, </span><span class="hl-6">del</span><span class="hl-1">, </span><span class="hl-6">request</span><span class="hl-1">, </span><span class="hl-6">use</span><span class="hl-1">, </span><span class="hl-6">ctx</span><span class="hl-1"> } = </span><span class="hl-7">createByNativeFetch</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">  </span><span class="hl-0">b</span><span class="hl-1">?: </span><span class="hl-8">Record</span><span class="hl-1">&lt;</span><span class="hl-8">any</span><span class="hl-1">, </span><span class="hl-8">any</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">q</span><span class="hl-1">?: </span><span class="hl-8">Record</span><span class="hl-1">&lt;</span><span class="hl-8">any</span><span class="hl-1">, </span><span class="hl-8">any</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">  </span><span class="hl-0">p</span><span class="hl-1">?: </span><span class="hl-8">Record</span><span class="hl-1">&lt;</span><span class="hl-8">any</span><span class="hl-1">, </span><span class="hl-8">any</span><span class="hl-1">&gt;;</span><br/><span class="hl-1">}&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">// ...</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;before&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">q</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">Object</span><span class="hl-1">.</span><span class="hl-7">assign</span><span class="hl-1">(</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">, </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">q</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">b</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">body</span><span class="hl-1"> &amp;&amp; (</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">body</span><span class="hl-1"> = </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">b</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">p</span><span class="hl-1"> &amp;&amp; </span><span class="hl-0">Object</span><span class="hl-1">.</span><span class="hl-7">assign</span><span class="hl-1">(</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">param</span><span class="hl-1">, </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">p</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-4">// 封装接口，传入泛型，只需要定义p的类型便可</span><br/><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">getUserInfo</span><span class="hl-1"> = </span><span class="hl-7">get</span><span class="hl-1">&lt;{ </span><span class="hl-0">p</span><span class="hl-1">: { </span><span class="hl-0">id</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1"> } }&gt;(</span><span class="hl-3">&quot;/user/:id&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// 使用时会有类型校验，必须传入p.id，否则报错</span><br/><span class="hl-7">getUserInfo</span><span class="hl-1">({ </span><span class="hl-0">p:</span><span class="hl-1"> { </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> } });</span>
</code><button>Copy</button></pre>
<a id="md:全局的错误消息通知或成功消息通知" class="tsd-anchor"></a><h3><a href="#md:全局的错误消息通知或成功消息通知">全局的错误消息通知或成功消息通知</a></h3><p>自定义错误消息，成功消息，可以自定义是否通知</p>
<pre><code class="language-ts"><span class="hl-2">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">get</span><span class="hl-1">, </span><span class="hl-6">use</span><span class="hl-1"> } = </span><span class="hl-7">createByNativeFetch</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">  </span><span class="hl-0">sucMsg</span><span class="hl-1">?: </span><span class="hl-8">boolean</span><span class="hl-1"> | </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">// 操作成功时的消息，传入布尔值代表请求成功是否通知ctx.message，传入字符串代表请求成功后通知该内容</span><br/><span class="hl-1">  </span><span class="hl-0">errMsg</span><span class="hl-1">?: </span><span class="hl-8">boolean</span><span class="hl-1"> | </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">// 操作失败时的消息，传入布尔值代表请求报错是否通知ctx.message，传入字符串代表请求报错后通知该内容</span><br/><span class="hl-1">}&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">// ...</span><br/><br/><span class="hl-1">  </span><span class="hl-0">errMsg:</span><span class="hl-1"> </span><span class="hl-5">true</span><span class="hl-1">, </span><span class="hl-4">// 默认进行错误通知</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// 统一message</span><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;final&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">// 可以为业务msg，或是http状态，等等由实际业务决定</span><br/><span class="hl-1">  </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">message</span><span class="hl-1"> = </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">data</span><span class="hl-1">.</span><span class="hl-0">msg</span><span class="hl-1"> || </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">response</span><span class="hl-1">.</span><span class="hl-0">statusText</span><span class="hl-1"> || </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">message</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><span class="hl-4">// 成功提示，优先级为ctx.sucMsg &gt; ctx.message</span><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;final&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">if</span><span class="hl-1"> (!</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">sucMsg</span><span class="hl-1"> || </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">return</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">message</span><span class="hl-1"> = </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">sucMsg</span><span class="hl-1"> === </span><span class="hl-5">true</span><span class="hl-1"> || </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">sucMsg</span><span class="hl-1"> !== </span><span class="hl-3">&quot;string&quot;</span><span class="hl-1"> ? </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">message</span><span class="hl-1"> : </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">sucMsg</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">// 这里用element组件的api进行通知</span><br/><span class="hl-1">  </span><span class="hl-0">ElMessage</span><span class="hl-1">.</span><span class="hl-7">success</span><span class="hl-1">(</span><span class="hl-0">message</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><span class="hl-4">// 错误提示，优先级为ctx.errMsg &gt; ctx.message</span><br/><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;final&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">if</span><span class="hl-1"> (!</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">errMsg</span><span class="hl-1"> || !</span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">return</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">message</span><span class="hl-1"> = </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">errMsg</span><span class="hl-1"> === </span><span class="hl-5">true</span><span class="hl-1"> || </span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">errMsg</span><span class="hl-1"> !== </span><span class="hl-3">&quot;string&quot;</span><span class="hl-1"> ? </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">message</span><span class="hl-1"> : </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">errMsg</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">// 这里用element组件的api进行通知</span><br/><span class="hl-1">  </span><span class="hl-0">ElMessage</span><span class="hl-1">.</span><span class="hl-7">error</span><span class="hl-1">(</span><span class="hl-0">message</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-4">// 定义接口</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">getUserInfo</span><span class="hl-1"> = </span><span class="hl-7">get</span><span class="hl-1">&lt;{ </span><span class="hl-0">param</span><span class="hl-1">: { </span><span class="hl-0">id</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1"> } }&gt;(</span><span class="hl-3">&quot;/user/:id&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-4">// 使用</span><br/><span class="hl-4">// 请求成功后会通知“获取成功”，请求失败后会通知“获取失败”</span><br/><span class="hl-7">getUserInfo</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">param:</span><span class="hl-1"> { </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">sucMsg:</span><span class="hl-1"> </span><span class="hl-3">&quot;获取成功&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">errMsg:</span><span class="hl-1"> </span><span class="hl-3">&quot;获取失败&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><span class="hl-4">// 请求成功或失败都不会有通知</span><br/><span class="hl-7">getUserInfo</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">param:</span><span class="hl-1"> { </span><span class="hl-0">id:</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">sucMsg:</span><span class="hl-1"> </span><span class="hl-5">false</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">errMsg:</span><span class="hl-1"> </span><span class="hl-5">false</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:20更新了什么？" class="tsd-anchor"></a><h2><a href="#md:20更新了什么？">2.0更新了什么？</a></h2><ul>
<li><strong>通过不同的requester，支持不同的运行环境</strong>，例如原生web使用nativeFetachRequester、uniapp使用uniappRequester</li>
<li>自定义requester、通过defineRequester可以自定义请求器，您甚至可以将ajax(xhr)作为请求器使用！并且有完善的类型支持！</li>
<li>代码、类型近乎完全的重构，代码结构更加合理，类型支持更加完善</li>
<li>log样式更新，新增请求耗时的展示</li>
<li>baseURL 和 url 更改为 base 和 path，同时添加了fullPath，url更改<ul>
<li>base：原baseURL，请求基本路径或链接</li>
<li>path：原url，请求路径</li>
<li>fullPath：query与param拼接后的路径</li>
<li>url：请求的完整链接地址（base + fullPath）</li>
</ul>
</li>
<li>对相关api命名更改<ul>
<li>createAPI -&gt; createByNativeFetch</li>
<li>run -&gt; exec</li>
<li>……</li>
</ul>
</li>
<li><strong>无限柯里化配置回归！</strong>，带有完善的类型支持</li>
<li>移除b、q、p配置（body、query、param）的别名，但可以自己通过before中间件实现</li>
<li>……</li>
</ul>
<a id="md:迁移至20" class="tsd-anchor"></a><h2><a href="#md:迁移至20">迁移至2.0</a></h2><p>2.0 带来了些许破坏式更新，但他们大多是一些命名的更新，迁移难度不高</p>
<ul>
<li><p>createAPI 更改为 createByNativeFetch，若要从@wsvaio/uniapp迁移，只需要<code>const createAPI = create(unqippRequester)</code>即可</p>
</li>
<li><p>b、q、p支持移除，可添加前置中间件实现 <a href="#md:为querybodyparam添加别名支">为query、body、param添加别名支持q、b、p</a></p>
</li>
<li><p>baseURL 和 url 更改为 base 和 path，可通过全局替换迁移，或添加前置中间件</p>
<pre><code class="language-ts"><span class="hl-7">use</span><span class="hl-1">(</span><span class="hl-3">&quot;before&quot;</span><span class="hl-1">)(</span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1"> </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">base</span><span class="hl-1"> = </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">baseURL</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">path</span><span class="hl-1"> = </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">url</span><span class="hl-1">;</span><br/><br/><span class="hl-1">  </span><span class="hl-4">// 若有报错可忽略</span><br/><span class="hl-1">  </span><span class="hl-5">delete</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">baseURL</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">delete</span><span class="hl-1"> </span><span class="hl-0">ctx</span><span class="hl-1">.</span><span class="hl-0">url</span><span class="hl-1">;</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
</li>
<li><p>无限柯里化的回归，请在非调用配置中添加 <code>{ config: true }</code></p>
</li>
<li><p>柯里化泛型，D -&gt; data，请用data声明类型 <code>get&lt;{ D: string }&gt;(/test) -&gt; get&lt;{ data: string }&gt;(/test)</code></p>
</li>
<li><p>……</p>
</li>
</ul>
<a id="md:后续" class="tsd-anchor"></a><h2><a href="#md:后续">后续</a></h2><ul>
<li>考虑更改架构（monorepo），主要是将不同平台的requester抽离出去</li>
<li>考虑更改包名称（实在想不出好名字），欢迎提issue</li>
<li>有生之年更新完善的文档（vitepress）</li>
<li>持续的更新优化代码</li>
</ul>
<a id="md:源码" class="tsd-anchor"></a><h2><a href="#md:源码">源码</a></h2><p>源码可以在 <a href="https://github.com/wsvaio/api">GitHub 仓库</a> 中找到。</p>
<a id="md:贡献" class="tsd-anchor"></a><h2><a href="#md:贡献">贡献</a></h2><p>如果您发现@wsvaio/api 中有任何问题或缺少某些功能，请随时提交问题或请求。</p>
<p>欢迎您的贡献，包括提交错误修复、添加新功能或改进文档。</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:wsvaioapi"><span>@wsvaio/api</span></a><ul><li><a href="#md:特性"><span>特性</span></a></li><li><a href="#md:api"><span>API</span></a></li><li><a href="#md:快速使用"><span>快速使用</span></a></li><li><ul><li><a href="#md:安装"><span>安装</span></a></li><li><a href="#md:使用方法"><span>使用方法</span></a></li></ul></li><li><a href="#md:通用性"><span>通用性</span></a></li><li><a href="#md:自定义requester"><span>自定义requester</span></a></li><li><a href="#md:中间件"><span>中间件</span></a></li><li><ul><li><a href="#md:请求前中间件"><span>请求前中间件</span></a></li><li><a href="#md:请求后中间件"><span>请求后中间件</span></a></li><li><a href="#md:错误处理中间件"><span>错误处理中间件</span></a></li><li><a href="#md:最终处理中间件"><span>最终处理中间件</span></a></li></ul></li><li><a href="#md:柯里化配置"><span>柯里化配置</span></a></li><li><a href="#md:typescirpt"><span>Typescirpt</span></a></li><li><a href="#md:扩展、继承-api-实例"><span>扩展、继承 API 实例</span></a></li><li><a href="#md:日志打印"><span>日志打印</span></a></li><li><a href="#md:额外扩展示例"><span>额外扩展示例</span></a></li><li><ul><li><a href="#md:全局的错误消息通知或成功消息通知"><span>全局的错误消息通知或成功消息通知</span></a></li></ul></li><li><a href="#md:20更新了什么？"><span>2.0更新了什么？</span></a></li><li><a href="#md:迁移至20"><span>迁移至2.0</span></a></li><li><a href="#md:后续"><span>后续</span></a></li><li><a href="#md:源码"><span>源码</span></a></li><li><a href="#md:贡献"><span>贡献</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@wsvaio/api</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>